# Используем официальный Go образ в качестве базового
FROM golang:1.24-alpine as builder

# Устанавливаем рабочую директорию в контейнере
WORKDIR /app

# Копируем все файлы проекта в контейнер
COPY . .

# Скачиваем все зависимости и компилируем приложение
RUN go mod tidy
RUN go build -o main .

# Используем минимальный образ для финального контейнера
FROM alpine:latest

# Устанавливаем необходимые библиотеки для работы Go приложения
RUN apk --no-cache add ca-certificates

COPY .env /app/.env

# Копируем скомпилированный бинарник из builder контейнера
COPY --from=builder /app/main /main

# Открываем порт, на котором будет работать наше приложение
EXPOSE 9000

# Указываем команду для запуска приложения
CMD ["/main"]
